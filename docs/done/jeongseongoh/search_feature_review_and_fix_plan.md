# 통합 검색 기능 검토 및 개선 계획

## 1. 개요

다른 AI가 1차적으로 구현한 통합 검색 기능의 코드 변경사항을 검토하고, 현재 발생 중인 문제점들의 원인을 분석하여 이를 해결하기 위한 구체적인 개선 계획을 제시합니다.

## 2. 현황 진단

### 2.1. 구현된 내용
-   전역 헤더 검색창을 통한 통합 검색 진입
-   `SearchService`에서 '전체' 탭(미리보기)과 '개별' 탭(전체 목록) 로직 분리
-   `htmx`를 이용한 탭 콘텐츠 동적 로딩 및 페이지네이션
-   인기 검색어 저장을 위한 백엔드 로직 및 API

### 2.2. 문제점 및 기획 누락사항
1.  **[BUG]** 검색 결과의 이미지에 **지연 로딩(Lazy Loading)이 미적용**되어 있습니다.
2.  **[BUG]** 개별 탭 클릭 시, **탭의 숫자 배지**가 전체 결과 수로 업데이트되지 않습니다. (예: '레시피 (5)' -> 클릭 후에도 5 유지)
3.  **[BUG]** 탭 전환 시 브라우저의 **URL이 변경되지 않아** 새로고침 시 상태가 유지되지 않습니다.
4.  **[BUG]** '[더보기]' 버튼 클릭 시 브라우저 콘솔에 **JS 에러(`Illegal invocation`)**가 발생하며, 탭 전환이 불안정합니다.
5.  **[PLAN]** 기획서에 명시된 **'상세 검색 링크'** 기능이 누락되었습니다.
6.  **[PLAN]** 백엔드만 구현된 **'자동 완성'** 기능의 프론트엔드 UI가 누락되었습니다.

## 3. 문제 원인 및 해결 계획

### 3.1. 이미지 지연 로딩 (Lazy Loading)
-   **원인**: `search/fragments.html`의 `<img>` 태그가 `recipes/list.html`과 달리 `th:src`를 직접 사용하고 있어 지연 로딩이 적용되지 않습니다.
-   **해결**: `search/fragments.html`의 레시피 이미지 태그를 `recipes/list.html`과 동일하게 `th:data-src`와 `lazy-load` 클래스를 사용하도록 수정하고, 관련 JS가 전역으로 로드되도록 보장합니다.

### 3.2. 탭 숫자 배지 불일치
-   **원인**: `htmx` 요청 시 `hx-target`이 결과 목록 `div`만 지정하여, 탭 버튼을 포함한 상위 UI가 업데이트되지 않기 때문입니다.
-   **해결**: `htmx`의 **Out of Band Swaps** 기능을 사용합니다.
    1.  **백엔드**: `SearchController`의 `/fragments` 메소드가 결과 목록과 함께, **업데이트된 탭 버튼 HTML 조각**도 모델에 담아 반환하도록 수정합니다.
    2.  **프론트엔드**: 반환된 HTML 조각에 `hx-swap-oob="true"` 속성을 추가하여, `htmx`가 타겟 영역 외의 부분(탭 버튼)도 교체하도록 지시합니다.

### 3.3. 탭 전환 시 URL 미변경
-   **원인**: `results.html`의 탭 버튼 `<a>` 태그에 `hx-push-url="true"` 속성이 없습니다.
-   **해결**: 각 탭 버튼의 `htmx` 속성에 `hx-push-url="true"`를 추가하여, `GET` 요청 URL을 브라우저 히스토리에 반영하도록 합니다.

### 3.4. '[더보기]' 버튼 JS 에러 및 오작동
-   **원인**: '[더보기]' 버튼이 Bootstrap 탭 기능(`data-bs-toggle="tab"`)과 `htmx` 요청(`hx-get`)을 동시에 실행하려다 충돌이 발생합니다.
-   **해결**: 역할을 분리합니다.
    1.  `results.html`의 '[더보기]' 버튼에서는 `hx-get` 등 `htmx` 관련 속성을 모두 **제거**합니다.
    2.  대신, Bootstrap의 `data-bs-target`을 이용하여 상단의 해당 카테고리 탭을 활성화시키는 역할만 하도록 둡니다.
    3.  상단 탭 버튼에 `hx-trigger="click once"` 대신 `click`을 사용하고, Bootstrap 이벤트(`show.bs.tab`)와 연동하여 필요 시에만 `htmx` 요청이 발생하도록 수정하여 안정성을 높입니다.

### 3.5. '상세 검색 링크' 및 '자동 완성' UI 구현
-   **해결**:
    1.  **상세 검색 링크**: `search/fragments.html`의 각 결과 목록 상단에 기획서 내용대로 "상세 검색으로 이동" 링크(`<a>` 태그)를 추가합니다.
    2.  **자동 완성 UI**: `header.html`의 검색창 하단에 드롭다운 목록을 추가하고, `fetch` API와 간단한 JavaScript를 사용하여 입력 시 `/search/popular-keywords` API를 호출하고 결과를 동적으로 표시하는 기능을 구현합니다.

## 4. 단계별 실행 계획
1.  **1단계 (버그 수정)**: 3.1 ~ 3.4에 기술된 4가지 핵심 버그를 먼저 수정하여 기능의 안정성을 확보합니다.
2.  **2단계 (누락 기능 구현)**: 3.5에 기술된 '상세 검색 링크'와 '자동 완성' 프론트엔드 UI를 구현합니다.
3.  **3단계 (최종 검토)**: 수정 및 구현된 모든 기능이 기획서와 일치하는지 최종적으로 검토하고 테스트합니다.
