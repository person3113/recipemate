<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: layout(~{::title}, ~{::main-content}, ~{::additional-head}, ~{::additional-scripts})}">
<head>
    <th:block th:fragment="title">마이페이지 - RecipeMate</th:block>

    <th:block th:fragment="additional-head">
        <style>
            .hover-shadow {
                transition: all 0.3s ease;
            }
            .hover-shadow:hover {
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
                transform: translateY(-2px);
            }
        </style>
    </th:block>
</head>
<body>
    <main th:fragment="main-content" class="container my-5">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <!-- Page Header -->
                <div class="mb-4">
                    <h1 class="display-5 fw-bold">
                        <i class="bi bi-person-circle text-primary"></i> 마이페이지
                    </h1>
                    <p class="text-muted">내 활동 내역과 정보를 한눈에 확인하세요!</p>
                </div>

                <!-- Messages -->
                <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="bi bi-check-circle-fill"></i>
                    <span th:text="${message}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                
                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    <span th:text="${error}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Profile Summary Card -->
                <div class="card shadow-sm mb-4" th:object="${user}">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <!-- Profile Image & Name -->
                            <div class="col-md-3 text-center mb-3 mb-md-0">
                                <div class="mb-2">
                                    <img th:if="*{profileImageUrl}" 
                                         th:src="*{profileImageUrl}" 
                                         alt="프로필 이미지" 
                                         class="rounded-circle"
                                         style="width: 100px; height: 100px; object-fit: cover;">
                                    <div th:unless="*{profileImageUrl}" 
                                         class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center"
                                         style="width: 100px; height: 100px;">
                                        <i class="bi bi-person-circle text-muted" style="font-size: 4rem;"></i>
                                    </div>
                                </div>
                                <h4 class="mb-1">
                                    <a th:href="@{/users/profile/{nickname}(nickname=*{nickname})}" 
                                       class="text-decoration-none text-dark hover-link"
                                       th:text="*{nickname}">닉네임</a>
                                </h4>
                                <p class="text-muted small mb-0" th:text="*{email}">email@example.com</p>
                            </div>
                            
                            <!-- Stats Grid (통계 + 설정) -->
                            <div class="col-md-9">
                                <div class="row g-3">
                                    <!-- 매너온도 카드 -->
                                    <div class="col-md-3">
                                        <a th:href="@{/users/me/manner-histories}" class="text-decoration-none">
                                            <div class="card border-0 bg-light h-100 text-center p-3 hover-shadow">
                                                <div class="text-warning mb-2">
                                                    <i class="bi bi-thermometer-half" style="font-size: 2rem;"></i>
                                                </div>
                                                <h5 class="mb-0 fw-bold" th:text="*{mannerTemperature} + '°C'">36.5°C</h5>
                                                <small class="text-muted">매너온도</small>
                                            </div>
                                        </a>
                                    </div>
                                    
                                    <!-- 포인트 카드 -->
                                    <div class="col-md-3">
                                        <a th:href="@{/users/me/points}" class="text-decoration-none">
                                            <div class="card border-0 bg-light h-100 text-center p-3 hover-shadow">
                                                <div class="text-primary mb-2">
                                                    <i class="bi bi-coin" style="font-size: 2rem;"></i>
                                                </div>
                                                <h5 class="mb-0 fw-bold" th:text="${#numbers.formatInteger(currentPoints, 0, 'COMMA')} + 'P'">0P</h5>
                                                <small class="text-muted">포인트</small>
                                            </div>
                                        </a>
                                    </div>
                                    
                                    <!-- 배지 카드 (개수 동적 표시) -->
                                    <div class="col-md-3">
                                        <a th:href="@{/users/me/badges}" class="text-decoration-none">
                                            <div class="card border-0 bg-light h-100 text-center p-3 hover-shadow">
                                                <div class="text-success mb-2">
                                                    <i class="bi bi-trophy" style="font-size: 2rem;"></i>
                                                </div>
                                                <h5 class="mb-0 fw-bold" th:text="${badgeCount ?: 0} + '개'">0개</h5>
                                                <small class="text-muted">보유 배지</small>
                                            </div>
                                        </a>
                                    </div>
                                    
                                    <!-- 설정 카드 (통계 카드와 동일한 스타일) -->
                                    <div class="col-md-3">
                                        <a th:href="@{/users/me/settings}" class="text-decoration-none">
                                            <div class="card border-0 bg-light h-100 text-center p-3 hover-shadow">
                                                <div class="text-secondary mb-2">
                                                    <i class="bi bi-gear" style="font-size: 2rem;"></i>
                                                </div>
                                                <h5 class="mb-0 fw-bold">설정</h5>
                                                <small class="text-muted">계정 관리</small>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity List Section -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">
                            <i class="bi bi-activity"></i> 내 활동
                        </h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a th:href="@{/users/me/community}" 
                           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-chat-dots text-primary me-2"></i>
                                커뮤니티 활동
                            </span>
                            <i class="bi bi-chevron-right text-muted"></i>
                        </a>
                        
                        <a th:href="@{/users/me/recipes}" 
                           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-book text-success me-2"></i>
                                작성한 레시피
                            </span>
                            <i class="bi bi-chevron-right text-muted"></i>
                        </a>
                        
                        <a th:href="@{/users/me/corrections}" 
                           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-lightbulb text-warning me-2"></i>
                                개선 제안 내역
                            </span>
                            <i class="bi bi-chevron-right text-muted"></i>
                        </a>
                        
                        <a th:href="@{/users/me/group-purchases}" 
                           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-shop text-warning me-2"></i>
                                주최한 공구
                            </span>
                            <i class="bi bi-chevron-right text-muted"></i>
                        </a>
                        
                        <a th:href="@{/users/me/participations}" 
                           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <span>
                                <i class="bi bi-cart-check text-info me-2"></i>
                                참여한 공구
                            </span>
                            <i class="bi bi-chevron-right text-muted"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <th:block th:fragment="additional-scripts">
        <!-- No additional scripts needed -->
    </th:block>
</body>
</html>
