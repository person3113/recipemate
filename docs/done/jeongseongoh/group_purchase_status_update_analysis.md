# 공동구매 상태 자동 업데이트 기능 분석 및 개선 방안

## 1. 문제 현상

- **요청 사항:** 공동구매 마감 시간(deadline)이 지나도 `imminent` 상태가 `closed`로 자동 변경되지 않음.
- **기대 행동:** 마감 시간이 되면 자동으로 `closed` 상태로 변경되어야 함.
- **재현:** `deadline`이 `11-11 14:04:00`인 공동구매가 `11-11 14:05`이후에도 여전히 `imminent` 상태로 표시됨.

## 2. 코드베이스 분석 결과

`codebase_investigator`를 통해 코드베이스를 분석한 결과, 공동구매 상태를 자동 업데이트하는 기능은 이미 구현되어 있었습니다.

- **관련 파일:** `src/main/java/com/recipemate/domain/groupbuy/service/GroupBuyScheduler.java`
- **핵심 로직:** `updateGroupBuyStatus` 메서드 내에서 `RECRUITING` 또는 `IMMINENT` 상태이고 `deadline`이 현재 시간보다 이전인 모든 공동구매를 찾아 `CLOSED` 상태로 업데이트합니다.
- **스케줄링 활성화:** `@EnableScheduling` 어노테이션이 설정되어 있어 스케줄링 기능은 활성화된 상태입니다.

### 원인 분석

문제의 핵심 원인은 **스케줄러의 실행 주기**에 있었습니다.

- **기존 설정:** `@Scheduled(cron = "0 0 * * * *")`
- **의미:** 스케줄러가 **매시 정각**에만 실행됩니다. (예: 1시 0분, 2시 0분)

따라서 14:04에 마감되는 공동구매는 다음 정각 실행 시간인 15:00까지 `imminent` 상태로 남아있게 됩니다. 이로 인해 사용자는 기능이 동작하지 않는 것처럼 느끼게 됩니다.

## 3. 해결 방안

스케줄러의 실행 주기를 요청대로 **30분 간격**으로 변경하여 상태 업데이트 지연을 줄입니다.

### 수정할 파일 및 내용

- **파일:** `src/main/java/com/recipemate/domain/groupbuy/service/GroupBuyScheduler.java`
- **수정 전:**
  ```java
  @Scheduled(cron = "0 0 * * * *")
  ```
- **수정 후:**
  ```java
  @Scheduled(cron = "0 0/30 * * * ?")
  ```

### 변경 후 동작

- `@Scheduled(cron = "0 0/30 * * * ?")` 설정은 스케줄러가 **매시 0분과 30분**에 실행되도록 합니다. (예: 1:00, 1:30, 2:00, 2:30)
- 이를 통해 공동구매 상태 업데이트의 최대 지연 시간이 30분으로 줄어들어 사용자의 불편을 크게 해소할 수 있습니다.

## 4. 추가 고려사항: 데드라인 30분 단위 설정 제안 분석

"데드라인 설정을 30분 간격으로 제한"하는 아이디어를 분석했습니다. 이는 스케줄러 실행 주기(30분)와 마감 시간을 동기화하여 사용자 경험을 향상시키는 것을 목표로 합니다.

### 장점

- **향상된 사용자 경험 (UX):** 스케줄 실행 시간과 마감 시간을 일치시켜 상태 변경이 거의 즉시 일어나는 것처럼 보이게 할 수 있습니다. 예를 들어, 14:30에 마감되도록 설정하면, 스케줄러가 정확히 14:30에 실행되어 상태를 `CLOSED`로 변경하므로 사용자는 지연을 느끼지 못합니다.
- **예측 가능성 증가:** 사용자는 마감 시간이 되면 '즉시' 상태가 변경될 것이라고 명확하게 인지할 수 있습니다. "14:04에 마감인데 왜 아직 `imminent` 상태지?"와 같은 혼란을 원천적으로 방지합니다.

- **구현 리소스 필요:** 기능을 구현하기 위해 프론트엔드와 백엔드 양쪽의 수정이 필요합니다.
    - **프론트엔드:** `src/main/resources/templates/group-purchases/form.html`의 `<input type="datetime-local">`에 `step` 속성(예: `step="1800"`)을 추가하고, 브라우저 호언성을 고려한 추가적인 JavaScript 유효성 검사 로직이 필요할 수 있습니다.
    - **백엔드:** 서버에서도 마감 시간의 분(minute)이 0 또는 30인지 검증하는 로직을 추가하여 데이터 정합성을 보장해야 합니다.

