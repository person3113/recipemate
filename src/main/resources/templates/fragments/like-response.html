<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<!-- 좋아요 버튼 업데이트 응답 (버튼 + OOB 헤더 통계) -->
<th:block th:fragment="like-response">
    <!-- 메인 응답: 좋아요 버튼 업데이트 -->
    <div th:id="|${targetType}-like-${targetId}|"
         class="like-container d-flex align-items-center gap-2">

        <!-- 로그인한 사용자만 버튼 활성화 -->
        <button sec:authorize="isAuthenticated()"
                type="button"
                class="btn btn-sm like-button"
                th:classappend="${isLiked} ? 'btn-danger' : 'btn-outline-danger'"
                th:hx-post="@{'/likes/' + ${targetType} + '/' + ${targetId}}"
                th:attr="hx-headers=|{&quot;${_csrf.headerName}&quot;: &quot;${_csrf.token}&quot;}|"
                th:hx-target="|#${targetType}-like-${targetId}|"
                hx-swap="outerHTML">
            <i class="bi" th:classappend="${isLiked} ? 'bi-heart-fill' : 'bi-heart'"></i>
            <span th:text="${isLiked} ? '좋아요 취소' : '좋아요'">좋아요</span>
        </button>

        <!-- 로그인하지 않은 사용자는 로그인 페이지로 이동하는 링크 -->
        <a sec:authorize="!isAuthenticated()"
           th:href="@{/auth/login}"
           class="btn btn-sm btn-outline-danger">
            <i class="bi bi-heart"></i>
            <span>좋아요</span>
        </a>

        <span class="like-count fw-bold" th:text="${likeCount}">0</span>
    </div>
    
    <!-- OOB 응답: 헤더 통계 업데이트 (있는 경우에만) -->
    <div th:if="${viewCount != null}"
         th:id="|${targetType}-header-stats-${targetId}|"
         class="text-muted"
         hx-swap-oob="true">
        <i class="bi bi-heart-fill text-danger"></i> <span th:text="${likeCount}">0</span>
        <span class="mx-2">·</span>
        <i class="bi bi-eye"></i> <span th:text="${viewCount}">0</span>
    </div>
</th:block>

</html>
