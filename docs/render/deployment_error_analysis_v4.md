# Render 배포 오류 분석 및 해결 방안 (4차)

## 현상

프로필 설정 관련 오류들을 모두 해결하고 4차 배포를 시도했으나, 다시 `Out of memory` (메모리 초과) 오류와 함께 배포에 실패했습니다.

## 4차 배포 실패 원인 분석

로그 분석 결과, 프로필 설정은 이제 완전히 정상적으로 동작하고 `prod` 프로필 하나만 올바르게 활성화되고 있습니다. 이는 이전 단계의 수정이 성공적이었음을 의미합니다.

이번 실패의 원인은 **애플리케이션이 실행되는 데 필요한 순수 메모리양이 Render 무료 플랜의 한도인 512MB를 초과**하기 때문입니다.

- **현재 JVM 메모리 설정:** `JAVA_OPTS` 환경 변수에 설정된 `-XX:MaxRAMPercentage=75.0` 옵션은 컨테이너 메모리(512MB)의 75%인 약 **384MB**를 자바 힙(Heap) 메모리로 할당합니다.
- **힙 외 추가 메모리:** 애플리케이션은 힙 메모리 외에도 클래스 정보를 저장하는 **Metaspace**, 스레드 스택, 네이티브 메모리 등 다양한 영역을 사용합니다. 힙 메모리를 384MB로 설정하면 나머지 영역들이 사용할 수 있는 공간은 약 128MB로 제한됩니다.
- **결론:** 현재 애플리케이션은 힙 외 메모리 영역에서 128MB 이상을 사용하고 있어, 총 메모리 사용량이 512MB를 초과하여 Render가 프로세스를 강제 종료시킨 것입니다. 이전의 설정 오류들이 해결되자 비로소 애플리케이션의 근본적인 메모리 요구량 문제가 드러났습니다.

## 해결 방안

Render의 512MB 무료 플랜 환경에서 애플리케이션을 실행시키려면, JVM이 사용하는 메모리 총량을 더 보수적으로 관리하도록 튜닝해야 합니다.

이를 위해 Render 대시보드에서 **`JAVA_OPTS` 환경 변수를 수정**하는 것을 권장합니다.

1.  Render에서 배포된 웹 서비스의 **Environment** 메뉴로 이동합니다.
2.  `JAVA_OPTS`라는 이름의 환경 변수를 찾아 값을 아래와 같이 변경합니다.

-   **기존 값:**
    ```
    -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0 -XX:+UseG1GC -Djava.security.egd=file:/dev/./urandom
    ```

-   **새로운 추천 값:**
    ```
    -Xmx300m -XX:MaxMetaspaceSize=128m -XX:+UseContainerSupport -Djava.security.egd=file:/dev/./urandom
    ```

### 변경 사항 상세 설명

| 옵션 | 변경 내용 | 이유 |
| :--- | :--- | :--- |
| `-XX:MaxRAMPercentage=75.0` | **제거** | 비율 기반 설정 대신, 더 안정적인 고정 크기 할당으로 전환합니다. |
| `-Xmx300m` | **추가** | 자바 힙 메모리의 최대 크기를 **300MB**로 명시적으로 제한합니다. 이로써 힙 외 메모리 영역이 약 212MB의 여유 공간을 확보하게 됩니다. |
| `-XX:MaxMetaspaceSize=128m` | **추가** | Metaspace의 최대 크기를 **128MB**로 제한하여, 이 영역이 과도하게 커지는 것을 방지합니다. |
| `-XX:+UseG1GC` | **제거** | G1GC 가비지 컬렉터는 작은 힙 환경에서는 오히려 메모리 오버헤드를 유발할 수 있습니다. 이 옵션을 제거하여 JVM이 해당 환경에 더 적합한 기본 GC를 선택하도록 합니다. |

## 다음 단계

1.  Render 대시보드에서 `JAVA_OPTS` 환경 변수를 위 **새로운 추천 값**으로 업데이트합니다.
2.  Render 대시보드에서 **"Manual Deploy"** > **"Deploy latest commit"** 버튼을 눌러 재배포를 실행합니다.

코드를 변경할 필요는 없으며, Render의 환경 변수 설정만 변경하면 됩니다.
