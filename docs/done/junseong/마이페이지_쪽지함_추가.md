# 마이페이지 쪽지함 기능 추가 완료

## ✅ 구현 완료

### 1. 마이페이지에 쪽지함 바로가기 추가

**위치**: `templates/user/my-page.html`

**추가된 기능:**
- 바로가기 메뉴 최상단에 "쪽지함" 링크 추가
- 안 읽은 쪽지가 있을 경우 빨간 배지로 개수 표시
- 아이콘: 편지 봉투 (`bi-envelope-fill`)

**HTML 코드:**
```html
<a th:href="@{/direct-messages/contacts}" class="list-group-item list-group-item-action">
    <i class="bi bi-envelope-fill text-primary"></i>
    <span class="ms-2">쪽지함</span>
    <span th:if="${unreadMessageCount > 0}" 
          class="badge bg-danger rounded-pill float-end"
          th:text="${unreadMessageCount}">0</span>
</a>
```

### 2. UserController 수정

**파일**: `UserController.java`

**변경사항:**
- `DirectMessageService` 의존성 주입
- `myPage()` 메서드에서 안 읽은 메시지 개수 조회
- Model에 `unreadMessageCount` 추가

**코드:**
```java
private final DirectMessageService directMessageService;

@GetMapping("/me")
public String myPage(@AuthenticationPrincipal UserDetails userDetails, Model model) {
    // ...existing code...
    
    // 안 읽은 쪽지 개수 조회
    long unreadMessageCount = directMessageService.getUnreadCount(user.getId());
    
    model.addAttribute("unreadMessageCount", unreadMessageCount);
    return "user/my-page";
}
```

---

## 🎨 UI/UX

### 마이페이지 바로가기 메뉴 순서
1. 📬 **쪽지함** (NEW! - 안 읽은 메시지 배지 표시)
2. ❤️ 내 찜 목록
3. 🏆 내 배지
4. 💰 포인트 내역
5. 📖 내가 작성한 레시피
6. 🛒 내가 만든 공구
7. ✅ 참여중인 공구
8. 💬 내 커뮤니티 활동

### 안 읽은 메시지 표시
- **배지 색상**: 빨간색 (`bg-danger`)
- **위치**: 메뉴 항목 우측 (`float-end`)
- **형태**: 원형 pill 배지 (`rounded-pill`)
- **조건**: `unreadMessageCount > 0`일 때만 표시

---

## 📊 사용자 동선

### Case 1: 마이페이지에서 쪽지 확인
```
로그인 → 마이페이지 → 쪽지함 클릭 → 대화 목록 → 특정 대화 선택 → 메시지 확인/전송
```

### Case 2: 참여자 관리에서 쪽지 전송
```
공구 상세 → 참여자 관리 → 쪽지 버튼 클릭 → 대화방 → 메시지 전송
```

### Case 3: 안 읽은 메시지 확인
```
로그인 → 마이페이지 (빨간 배지 확인) → 쪽지함 클릭 → 읽지 않은 대화 확인
```

---

## 🔄 데이터 흐름

```
마이페이지 로드
    ↓
UserController.myPage()
    ↓
DirectMessageService.getUnreadCount(userId)
    ↓
DirectMessageRepository.countUnreadMessages(user)
    ↓
Model에 unreadMessageCount 추가
    ↓
View 렌더링 (배지 표시 여부 결정)
```

---

## ✨ 추가된 사용자 가치

1. **접근성 향상**: 마이페이지에서 바로 쪽지함 접근 가능
2. **알림 기능**: 안 읽은 메시지 개수를 시각적으로 표시
3. **직관적 UX**: 편지 봉투 아이콘으로 쪽지 기능 명확히 인식
4. **우선순위**: 바로가기 메뉴 최상단에 배치하여 중요도 강조

---

## 🧪 테스트 시나리오

### 시나리오 1: 안 읽은 메시지가 있는 경우
1. 사용자 A가 사용자 B에게 쪽지 전송
2. 사용자 B 로그인 → 마이페이지 이동
3. **결과**: "쪽지함" 옆에 빨간 배지 `1` 표시
4. 쪽지함 클릭 → 대화 목록에서 사용자 A 확인
5. 대화방 진입 → 메시지 읽음 처리
6. 다시 마이페이지 → 배지 사라짐

### 시나리오 2: 안 읽은 메시지가 없는 경우
1. 사용자 로그인 → 마이페이지 이동
2. **결과**: "쪽지함" 옆에 배지 표시 없음
3. 쪽지함 클릭 → 대화 목록 확인 (비어있을 수 있음)

### 시나리오 3: 여러 명에게서 메시지 수신
1. 사용자 A, B, C가 사용자 D에게 각각 쪽지 전송
2. 사용자 D 로그인 → 마이페이지 이동
3. **결과**: "쪽지함" 옆에 빨간 배지 `3` 표시

---

## 📋 수정된 파일 목록

1. ✅ `templates/user/my-page.html` - 쪽지함 링크 추가
2. ✅ `UserController.java` - DirectMessageService 주입 및 안 읽은 메시지 개수 조회
3. ✅ `쪽지_기능_사용_가이드.md` - 마이페이지 접근 방법 추가

---

## 🎯 완료 상태

**✅ 마이페이지 쪽지함 기능 100% 완료**

사용자는 이제:
- 마이페이지에서 한 번의 클릭으로 쪽지함 접근 가능
- 안 읽은 메시지가 있으면 즉시 확인 가능
- 직관적인 UI로 쪽지 기능 활용 가능

**빌드 상태**: ✅ BUILD SUCCESSFUL

