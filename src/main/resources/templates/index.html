<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/base :: layout(
        ~{::title},
        ~{::main-content},
        ~{::additional-head},
        ~{::additional-scripts}
      )}">
<head>
    <th:block th:fragment="title">RecipeMate - 레시피 기반 공동구매 플랫폼</th:block>
    <th:block th:fragment="additional-head">
        <!-- No additional head content needed - all styles moved to styles.css -->
    </th:block>
</head>
<body>
    <th:block th:fragment="main-content">
    
    <!-- Hero Section -->
    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-3 fw-bold mb-4">RecipeMate</h1>
            <p class="lead mb-5">레시피 기반 공동구매로 똑똑한 장보기</p>
            <div class="d-flex justify-content-center gap-3">
                <a th:href="@{/group-purchases/list}" class="btn btn-light btn-lg px-5">
                    <i class="bi bi-basket3"></i> 공동구매 둘러보기
                </a>
                <a th:href="@{/recipes}" class="btn btn-outline-light btn-lg px-5">
                    <i class="bi bi-book"></i> 레시피 찾기
                </a>
            </div>
        </div>
    </section>
    
    <!-- Popular Recipes Carousel Section -->
    <section th:if="${popularRecipes != null and !popularRecipes.isEmpty()}" class="py-5 bg-light">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0"><i class="bi bi-star-fill text-warning"></i> 인기 레시피</h2>
                <a th:href="@{/recipes}" class="text-primary text-decoration-none fw-semibold">
                    전체 보기 <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            
            <!-- 캐러셀 너비 제한 및 중앙 정렬 -->
            <div class="row justify-content-center">
                <div class="col-lg-10 col-xl-9">
                    <div id="popularRecipesCarousel" class="carousel slide position-relative" data-bs-ride="carousel" data-bs-interval="5000" style="padding: 0 50px;">
                <div class="carousel-indicators">
                    <button th:each="recipe, iterStat : ${popularRecipes}" 
                            type="button" 
                            data-bs-target="#popularRecipesCarousel" 
                            th:attr="data-bs-slide-to=${iterStat.index}"
                            th:classappend="${iterStat.index == 0} ? 'active' : ''"
                            th:aria-label="'Slide ' + ${iterStat.index + 1}">
                    </button>
                </div>
                <div class="carousel-inner">
                    <div th:each="recipe, iterStat : ${popularRecipes}" 
                         class="carousel-item" 
                         th:classappend="${iterStat.index == 0} ? 'active' : ''">
                        <div class="card border-0 shadow-lg">
                            <div class="row g-0">
                                <!-- Recipe Image -->
                                <div class="col-md-6">
                                    <div th:if="${recipe.imageUrl != null}" class="h-100">
                                        <img th:data-src="${recipe.imageUrl}" 
                                             th:alt="${recipe.name}"
                                             class="img-fluid w-100 h-100 object-fit-cover lazy-load"
                                             style="max-height: 300px;"
                                             src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E">
                                    </div>
                                    <div th:unless="${recipe.imageUrl != null}" 
                                         class="image-placeholder h-100 text-white" 
                                         style="min-height: 300px;">
                                        <i class="bi bi-egg-fried display-3"></i>
                                    </div>
                                </div>
                                
                                <!-- Recipe Info -->
                                <div class="col-md-6 d-flex align-items-center">
                                    <div class="card-body p-4">
                                        <span class="badge bg-warning text-dark mb-2">
                                            <i class="bi bi-star-fill"></i> 인기
                                        </span>
                                        <span th:if="${recipe.category != null}" 
                                              class="badge bg-primary mb-2 ms-2" 
                                              th:text="${recipe.category}">
                                            카테고리
                                        </span>
                                        <h4 class="card-title fw-bold mb-2" th:text="${recipe.name}">레시피 이름</h4>
                                        <p class="text-muted mb-3 small">
                                            <i class="bi bi-people-fill"></i> 
                                            <span th:text="'공구 연결 수 기준 인기 레시피'">인기 레시피</span>
                                        </p>
                                        
                                        <div class="d-grid gap-2">
                                            <a th:href="@{/recipes/{id}(id=${recipe.id})}" 
                                               class="btn btn-primary">
                                                <i class="bi bi-book"></i> 레시피 자세히 보기
                                            </a>
                                            <a sec:authorize="isAuthenticated()" 
                                               th:href="@{/group-purchases/new(recipeId=${recipe.id})}" 
                                               class="btn btn-outline-primary">
                                                <i class="bi bi-basket3"></i> 이 레시피로 공구 만들기
                                            </a>
                                            <a sec:authorize="!isAuthenticated()" 
                                               th:href="@{/auth/login(continue='/')}" 
                                               class="btn btn-outline-primary">
                                                <i class="bi bi-box-arrow-in-right"></i> 로그인하고 공구 만들기
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev position-absolute" type="button" data-bs-target="#popularRecipesCarousel" data-bs-slide="prev" style="left: 0; width: 50px;">
                    <span class="carousel-control-prev-icon bg-dark rounded-circle p-2" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next position-absolute" type="button" data-bs-target="#popularRecipesCarousel" data-bs-slide="next" style="right: 0; width: 50px;">
                    <span class="carousel-control-next-icon bg-dark rounded-circle p-2" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Features Section -->
    <section class="py-5 bg-white">
        <div class="container">
            <h2 class="text-center fw-bold mb-5">RecipeMate의 특별함</h2>
            <div class="row g-4">
                <!-- Feature 1 -->
                <div class="col-md-4">
                    <div class="card feature-card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-book-half section-icon-large text-primary"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">레시피 기반 공구</h5>
                            <p class="card-text text-muted">
                                레시피에 필요한 식재료를 한 번에 구매하세요. 
                                국내외 레시피 API 연동으로 다양한 요리 제공
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Feature 2 -->
                <div class="col-md-4">
                    <div class="card feature-card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-tags-fill section-icon-large text-primary"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">합리적인 가격</h5>
                            <p class="card-text text-muted">
                                대량 구매로 단가를 낮추고, 
                                신선한 식재료를 저렴하게 구입하세요
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Feature 3 -->
                <div class="col-md-4">
                    <div class="card feature-card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-people-fill section-icon-large text-primary"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">신뢰할 수 있는 커뮤니티</h5>
                            <p class="card-text text-muted">
                                매너온도 시스템으로 신뢰도를 관리하고, 
                                안전한 거래를 보장합니다
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Random Recipes Section -->
    <section class="py-5 bg-white">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0"><i class="bi bi-dice-5"></i> 오늘의 추천 레시피</h2>
                <a th:href="@{/recipes}" class="text-primary text-decoration-none fw-semibold">
                    더 많은 레시피 보기 <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            
            <div th:if="${randomRecipes != null and !randomRecipes.isEmpty()}" class="row g-4">
                <div th:each="recipe : ${randomRecipes}" class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <!-- Recipe Image -->
                        <div th:if="${recipe.imageUrl != null}">
                            <img th:data-src="${recipe.imageUrl}" 
                                 th:alt="${recipe.name}"
                                 class="card-img-top object-fit-cover lazy-load"
                                 style="height: 200px;"
                                 src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E">
                        </div>
                        <div th:unless="${recipe.imageUrl != null}" 
                             class="card-img-top image-placeholder text-white" 
                             style="height: 200px;">
                            <i class="bi bi-egg-fried display-4"></i>
                        </div>
                        
                        <!-- Recipe Info -->
                        <div class="card-body d-flex flex-column">
                            <div class="mb-2">
                                <span th:if="${recipe.category != null}" 
                                      class="badge bg-primary mb-2" 
                                      th:text="${recipe.category}">
                                    카테고리
                                </span>
                                <span class="badge bg-success mb-2 ms-1">
                                    <i class="bi bi-dice-5"></i> 추천
                                </span>
                            </div>
                            <h5 class="card-title fw-bold mb-3" th:text="${recipe.name}">레시피 이름</h5>
                            
                            <div class="mt-auto d-grid gap-2">
                                <a th:href="@{/recipes/{id}(id=${recipe.id})}" 
                                   class="btn btn-primary btn-sm">
                                    <i class="bi bi-book"></i> 레시피 보기
                                </a>
                                <a sec:authorize="isAuthenticated()" 
                                   th:href="@{/group-purchases/new(recipeId=${recipe.id})}" 
                                   class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-basket3"></i> 공구 만들기
                                </a>
                                <a sec:authorize="!isAuthenticated()" 
                                   th:href="@{/auth/login(continue='/')}" 
                                   class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-box-arrow-in-right"></i> 로그인하고 공구 만들기
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div th:if="${randomRecipes == null or randomRecipes.isEmpty()}" class="text-center py-5">
                <i class="bi bi-egg-fried display-1 text-muted"></i>
                <p class="fs-5 text-muted mt-3">추천 레시피를 불러올 수 없습니다.</p>
                <a th:href="@{/recipes}" class="btn btn-primary mt-3">
                    <i class="bi bi-book"></i> 전체 레시피 보기
                </a>
            </div>
        </div>
    </section>
    
    <!-- Imminent Group Buys Banner Section -->
    <section th:if="${imminentGroupBuys != null and !imminentGroupBuys.isEmpty()}" class="py-4 bg-warning">
        <div class="container">
            <div class="d-flex align-items-center mb-3">
                <h3 class="fw-bold mb-0 text-dark">
                    <i class="bi bi-alarm-fill"></i> 마감 임박! 서두르세요
                </h3>
                <span class="badge bg-danger ms-3 fs-6">48시간 이내 마감</span>
            </div>
            
            <div class="row g-3">
                <div th:each="groupBuy : ${imminentGroupBuys}" class="col-md-4">
                    <div class="card h-100 border-danger border-3 shadow">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title fw-bold mb-0" th:text="${groupBuy.title}">공구 제목</h5>
                                <span class="badge bg-danger">
                                    <i class="bi bi-alarm"></i> 임박
                                </span>
                            </div>
                            
                            <p class="text-muted small mb-2">
                                <i class="bi bi-clock"></i> 
                                마감: <span th:text="${#temporals.format(groupBuy.deadline, 'MM-dd HH:mm')}">날짜</span>
                            </p>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between text-sm text-muted mb-1">
                                    <small th:text="${groupBuy.currentHeadcount} + '/' + ${groupBuy.targetHeadcount} + '명'">0/10명</small>
                                    <small th:text="${#numbers.formatInteger((groupBuy.currentHeadcount * 100 / groupBuy.targetHeadcount), 0)} + '%'">0%</small>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-danger" 
                                         th:style="'width: ' + ${#numbers.formatInteger((groupBuy.currentHeadcount * 100 / groupBuy.targetHeadcount), 0)} + '%'">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-danger fw-bold fs-5" 
                                      th:text="${#numbers.formatInteger(groupBuy.targetAmount, 0, 'COMMA')} + '원'">
                                    10,000원
                                </span>
                                <a th:href="@{/group-purchases/{id}(id=${groupBuy.id})}" 
                                   class="btn btn-danger btn-sm">
                                    <i class="bi bi-lightning-fill"></i> 빠른 참여
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Hot Group Purchases Section -->
    <section class="py-5">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0"><i class="bi bi-fire text-danger"></i> 인기 공동구매</h2>
                <a th:href="@{/group-purchases/list}" class="text-primary text-decoration-none fw-semibold">
                    전체 보기 <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            
            <div th:if="${hotGroupBuys != null and !hotGroupBuys.isEmpty()}" class="row g-4">
                <div th:each="groupBuy : ${hotGroupBuys}" class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <!-- 공구 이미지가 있는 경우 -->
                        <div th:if="${groupBuy.imageUrls != null and !groupBuy.imageUrls.isEmpty()}" class="card-img-top" style="height: 250px; overflow: hidden;">
                            <img th:src="${groupBuy.imageUrls[0]}" class="w-100 h-100" alt="공구 이미지" style="object-fit: cover;">
                        </div>
                        <!-- 공구 이미지가 없지만 레시피 이미지가 있는 경우 -->
                        <div th:if="${(groupBuy.imageUrls == null or groupBuy.imageUrls.isEmpty()) and groupBuy.recipeImageUrl != null}" class="card-img-top" style="height: 250px; overflow: hidden;">
                            <img th:src="${groupBuy.recipeImageUrl}" class="w-100 h-100" alt="레시피 이미지" style="object-fit: cover;">
                        </div>
                        <!-- 공구 이미지도 레시피 이미지도 없는 경우 placeholder -->
                        <div th:if="${(groupBuy.imageUrls == null or groupBuy.imageUrls.isEmpty()) and groupBuy.recipeImageUrl == null}" class="card-img-top image-placeholder p-5 text-center text-white" style="height: 250px;">
                            <i class="bi bi-basket3 display-1"></i>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title fw-bold mb-0" th:text="${groupBuy.title}">공구 제목</h5>
                                 <span th:if="${groupBuy.status.name() == 'RECRUITING'}" class="badge bg-success">모집중</span>
                                <span th:if="${groupBuy.status.name() == 'IMMINENT'}" class="badge bg-warning">임박</span>
                                <span th:if="${groupBuy.status.name() == 'CLOSED'}" class="badge bg-secondary">마감</span>
                                 <span th:if="${groupBuy.status.name() == 'COMPLETED'}" class="badge bg-info">모집 성공</span>
                                <span th:if="${groupBuy.status.name() == 'CANCELLED'}" class="badge bg-danger">취소</span>
                            </div>
                            <p class="card-text text-muted small" th:text="${groupBuy.content}">공구 설명</p>
                            
                            <!-- Progress Bar -->
                            <div class="mb-3">
                                <div class="d-flex justify-between text-sm text-muted mb-1">
                                    <small th:text="${groupBuy.currentHeadcount} + '/' + ${groupBuy.targetHeadcount} + '명'">0/10명</small>
                                    <small th:text="${#numbers.formatInteger((groupBuy.currentHeadcount * 100 / groupBuy.targetHeadcount), 0)} + '%'">0%</small>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" 
                                         th:classappend="${groupBuy.currentHeadcount >= groupBuy.targetHeadcount} ? 'progress-bar-green' : (${groupBuy.currentHeadcount >= groupBuy.targetHeadcount * 0.6} ? 'progress-bar-blue' : 'progress-bar-gray')"
                                         th:style="'width: ' + ${#numbers.formatInteger((groupBuy.currentHeadcount * 100 / groupBuy.targetHeadcount), 0)} + '%'">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-primary fw-bold fs-5" th:text="${#numbers.formatInteger(groupBuy.targetAmount, 0, 'COMMA')} + '원'">10,000원</span>
                                <a th:href="@{/group-purchases/{id}(id=${groupBuy.id})}" class="btn btn-primary btn-sm">
                                    자세히 보기
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div th:if="${hotGroupBuys == null or hotGroupBuys.isEmpty()}" class="text-center py-5">
                <i class="bi bi-basket3 display-1 text-muted"></i>
                <p class="fs-5 text-muted mt-3">현재 진행 중인 공동구매가 없습니다.</p>
                <a th:href="@{/group-purchases/new}" class="btn btn-primary mt-3">
                    <i class="bi bi-plus-circle"></i> 첫 공동구매 시작하기
                </a>
            </div>
        </div>
    </section>
    
    <!-- CTA Section -->
    <section sec:authorize="!isAuthenticated()" class="py-5 text-white" style="background: linear-gradient(135deg, #FF6B35 0%, #FF8C5A 100%);">
        <div class="container text-center">
            <h2 class="fw-bold mb-3">지금 바로 시작하세요!</h2>
            <p class="lead mb-4">회원가입하고 합리적인 공동구매의 세계로</p>
            <div class="d-flex justify-content-center gap-3">
                <a th:href="@{/auth/signup}" class="btn btn-light btn-lg px-5">
                    <i class="bi bi-person-plus"></i> 회원가입
                </a>
                <a th:href="@{/auth/login}" class="btn btn-outline-light btn-lg px-5">
                    <i class="bi bi-box-arrow-in-right"></i> 로그인
                </a>
            </div>
        </div>
    </section>
    </th:block>
    
    <th:block th:fragment="additional-scripts">
        <!-- No additional scripts needed -->
    </th:block>
</body>
</html>
