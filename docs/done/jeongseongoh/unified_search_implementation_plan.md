# 통합 검색 기능 구현 계획 (v6 - 최종)

## 1. 개요

본 문서는 `docs/project_plan/9_통합검색.md`에 명시된 통합 검색 기능의 모든 요구사항을 구현하기 위해 현재 코드베이스를 점검하고, 이를 바탕으로 상세한 단계별 구현 계획을 제시하는 것을 목표로 합니다.

논의된 모든 사항(페이징, 탭 전환, 자동완성, 하이라이트, UI/UX 상세, '[더보기]' 버튼 역할)을 종합한 최종 버전의 구현 계획입니다.

## 2. 코드베이스 점검 결과 (문제의 핵심)

-   **분리된 검색 경로**: 현재 코드베이스에는 레시피를 검색하는 두 가지 경로가 존재합니다.
    1.  **레시피 목록 페이지 (`GET /recipes`)**: `RecipeController`가 페이징을 지원하는 최신 메소드(`RecipeService.findRecipes`)를 **올바르게 사용 중**입니다.
    2.  **통합 검색 페이지 (`GET /search`)**: `SearchController`와 `SearchService`가 페이징을 지원하지 않는 구형 메소드(`RecipeService.searchRecipes`)를 **잘못 사용 중**입니다.

-   **결론**: 통합 검색 기능(`SearchService`)이 잘못된 레시피 검색 메소드를 사용하는 것이 문제의 원인입니다. 따라서 **`SearchService`를 수정하는 것**이 해결의 핵심입니다.

## 3. 백엔드 구현 계획

### 3.1. 페이징 문제 해결 (최우선 과제)

`SearchService`가 올바른 페이징 지원 메소드를 호출하도록 수정합니다.

-   **위치**: `SearchService.java`
-   **변경 사항**: `searchRecipes` 내부 메소드가 `recipeService.findRecipes(keyword, ..., pageable)`을 호출하도록 수정하고, `unifiedSearch`가 `pageable` 객체를 전달하도록 변경합니다.

### 3.2. 탭 전환 기능 구현

`SearchController`가 `type` 파라미터(e.g., `ALL`, `RECIPE`)를 받도록 하고, `SearchService`는 이 값에 따라 로직을 분기합니다. (`URL_DESIGN.md`에 따라 `category` 대신 `type` 용어 사용)

-   `type=ALL`: 각 도메인별로 상위 3-5개씩만 조회합니다. (`PageRequest.of(0, 5)`)
-   `type=RECIPE` (또는 다른 특정 카테고리): 해당 도메인만 전체 페이징하여 조회합니다.

### 3.3. 검색어 자동완성 구현

-   **인기 검색어**: `SearchKeyword(keyword, searchCount)` 엔티티를 추가하고, 검색 시 `@Async`로 횟수를 업데이트합니다. `GET /search/popular-keywords` API를 통해 상위 10개를 제공합니다.
-   **최근 검색어**: 초기에는 프론트엔드의 `localStorage`를 활용하여 간단하게 구현합니다.

### 3.4. 검색어 하이라이트 구현

-   `SearchService`에서 DTO를 생성할 때, 검색 결과의 제목(`title`)에 포함된 검색어를 `<mark>` 태그로 감싸 `highlightedTitle` 필드에 담아 반환합니다.

## 4. 프론트엔드 및 UI/UX 상세 계획

### 4.1. 검색창 배치 및 역할

-   **전역 헤더**: 모든 페이지 상단에 위치한 헤더의 검색창을 **통합 검색의 주 진입점**으로 사용합니다. 이 검색창은 `GET /search?query=...` 로 요청을 보냅니다.
-   **결과 페이지 내 검색창**: `results.html`에 있던 기존 검색창은 전역 검색창과 역할이 중복되므로 **제거**하는 것을 권장합니다.

### 4.2. 상세 검색 및 필터링 연동 (UX 개선)

-   **원칙**: 통합 검색은 '넓고 얕은' 탐색을, 각 도메인 전용 목록 페이지는 '좁고 깊은' 탐색을 담당하도록 역할을 분리합니다.
-   **구현 방안**:
    -   통합 검색 결과 페이지(`results.html`)에는 각 도메인별 **상세 필터/정렬 기능을 구현하지 않습니다.**
    -   대신, 각 결과 섹션에 **"레시피 상세 검색으로 이동하기"** 와 같은 명확한 링크를 제공하여, 현재 검색어를 포함한 채로 해당 도메인의 전용 목록 페이지로 사용자를 안내합니다. (e.g., `/recipes?keyword=파스타`)

### 4.3. 프론트엔드 템플릿 구현 전략

#### 4.3.1. `th:if`와 `htmx`의 역할 분담

`th:if`와 `htmx`는 상충하는 기술이 아니며, 각각 다른 시점에서 역할을 수행하여 사용자 경험을 향상시킵니다.

1.  **`th:if` (최초 페이지 로딩)**
    -   사용자가 처음 검색 결과 페이지(`GET /search`)에 진입했을 때, 서버는 `search/results.html` **전체 페이지**를 렌더링합니다.
    -   이때는 `type=ALL` 상태이므로, `th:if`를 사용하여 레시피, 공구, 커뮤니티의 모든 섹션을 화면에 출력합니다.

2.  **`htmx` (탭 전환 등 부분 갱신)**
    -   페이지 로딩 후, 사용자가 '레시피' 탭을 클릭하면 `htmx`가 동작합니다.
    -   `htmx`는 페이지 전체를 새로고침하는 대신, 백그라운드에서 `GET /search/fragments?type=recipe` API를 호출합니다.
    -   서버는 이 요청에 대해 레이아웃이 없는 **순수한 HTML 조각(fragment)**만 응답합니다.
    -   `htmx`는 응답받은 HTML 조각을 기존 결과 표시 영역에 교체하여, 빠르고 부드러운 화면 전환을 구현합니다.

#### 4.3.2. 템플릿 상세 구현

-   **템플릿**: `search/results.html` 단일 파일을 사용합니다.
-   **탭 전환**: `htmx`의 `hx-get`, `hx-target` 속성을 사용하여 `/search/fragments`를 호출하고, 특정 `div`의 내용을 교체합니다.
-   **하이라이트**: `th:utext`를 사용하여 백엔드에서 받은 `highlightedTitle`의 `<mark>` 태그를 정상적으로 렌더링합니다.
-   **상세 페이지 이동**: `th:href`와 `entityType`을 조합하여 각 결과에 맞는 상세 페이지 URL을 동적으로 생성합니다.

### 4.4. '[더보기]' 버튼의 역할 및 페이지네이션 연동

-   **역할**: '전체' 탭에서 각 카테고리별 미리보기 섹션 하단에 위치한 '[더보기]' 버튼은 **해당 카테고리 탭을 클릭하는 것과 동일한 기능**을 수행합니다. 즉, 특정 카테고리의 전체 목록을 불러오는 단축 버튼입니다.
-   **동작**: '[더보기]' 버튼 클릭 시 `htmx`를 통해 해당 카테고리의 전체 목록(첫 페이지)을 동적으로 불러와 화면에 표시합니다.
-   **페이지네이션**: '[더보기]' 버튼을 통해 불러온 전체 목록은 **페이지네이션이 적용**됩니다. 목록 하단에 페이지 번호 또는 '더 불러오기' 버튼 등의 형태로 페이지네이션 UI가 제공될 것입니다. 이는 `SearchService`의 페이징 문제 해결을 통해 가능해집니다.